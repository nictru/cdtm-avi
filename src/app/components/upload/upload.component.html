<div class="file-upload-section">
    <div class="drag-drop-area" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)" [class.drag-over]="isDragging">
        <div class="drag-drop-content">
            <span class="drag-icon">üìÅ</span>
            <p>Drag files here or <label for="file-upload" class="file-upload-label">choose files
                    <input type="file" id="file-upload" accept=".pdf,.jpg,.jpeg,.png" multiple
                        (change)="onFileSelected($event)">
                </label></p>
        </div>
    </div>

    <div class="camera-section">
        <button class="camera-btn" (click)="showCameraOptionsDialog()">
            <span class="camera-icon">üì∑</span>
            Use Camera
        </button>
    </div>

    <!-- Camera options modal (centered popup) -->
    <div class="modal camera-modal" *ngIf="showCameraOptions">
        <div class="modal-content camera-modal-content">
            <button class="close-btn top-right" (click)="showCameraOptions = false">√ó</button>
            <h2>Choose Camera Option</h2>
            <div class="camera-options">
                <button class="option-btn" (click)="openDirectCamera()">
                    <span class="icon">üíª</span>
                    Use Current Device
                </button>
                <button class="option-btn" (click)="useSmartphoneOption()">
                    <span class="icon">üì±</span>
                    Use Smartphone
                </button>
            </div>
        </div>
    </div>

    <!-- Camera interface modal (popup) -->
    <div class="modal camera-popup" *ngIf="showCamera">
        <div class="modal-content camera-popup-content">
            <button class="close-btn top-right" (click)="stopCamera(); showCamera = false">√ó</button>
            <div class="camera-preview" *ngIf="!isCapturing">
                <video #cameraVideo autoplay playsinline></video>
                <div class="camera-controls">
                    <button class="capture-btn" (click)="captureImage()">
                        <span class="capture-icon">‚óè</span>
                    </button>
                </div>
            </div>
            <div class="preview-container" *ngIf="isCapturing">
                <img [src]="previewImage" alt="Captured photo">
                <div class="preview-controls">
                    <button class="retake-btn" (click)="retakePhoto()">Retake</button>
                    <button class="delete-btn" (click)="deletePhoto()">Delete</button>
                    <button class="accept-btn" (click)="acceptPhoto()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <div class="files-actions" *ngIf="uploadedFiles.length > 0">
        <button class="upload-btn" (click)="uploadFilesToSupabase()"
            [disabled]="isUploading || uploadedFiles.length === 0">
            {{isUploading ? 'Uploading...' : 'Upload Files'}}
        </button>
    </div>

    <div class="files-list" *ngIf="uploadedFiles.length > 0">
        <h4>Files ({{uploadedFiles.length}})</h4>
        <div class="file-item" *ngFor="let file of uploadedFiles; let i = index" [class.uploaded]="isFileUploaded(i)">
            <div class="file-info">
                <span class="file-icon">{{isPdf(file) ? 'üìÑ' : 'üñºÔ∏è'}}</span>
                <span class="file-name">{{ file.name }}</span>
                <span class="file-size">{{ formatFileSize(file.size) }}</span>
                <span class="upload-status" *ngIf="uploadProgress[file.name] > 0">
                    <span *ngIf="uploadProgress[file.name] === 100">‚úì</span>
                    <span *ngIf="uploadProgress[file.name] > 0 && uploadProgress[file.name] < 100">...</span>
                </span>
                <button class="remove-file" (click)="removeFile(i)">‚úï</button>
            </div>
        </div>
    </div>
</div>
